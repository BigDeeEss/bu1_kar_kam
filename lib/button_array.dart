// Import dart and flutter packages.
import 'package:flutter/material.dart';
import 'package:get_it_mixin/get_it_mixin.dart';

// Import project-specific files.
import 'package:kar_kam/button.dart';
import 'package:kar_kam/button_specs.dart';
import 'package:kar_kam/lib/get_it_service.dart';
import 'package:kar_kam/app_data.dart';

/// Implements a linear horizontal or vertical array of Buttons.
class ButtonArray extends StatelessWidget with GetItMixin {
  ButtonArray({Key? key}) : super(key: key);

  /// Generates a list of coordinates relative to any corner.
  static List<double> get buttonCoordinates =>
      GetItService.instance<AppData>().buttonCoordinates;

  // static List<double> get buttonCoordinates {
  //   // Get [buttonSpecList] within the instance of [AppData]
  //   // registered with [GetIt].
  //   List<ButtonSpec> buttonSpecList = GetItService
  //       .instance<AppData>()
  //       .buttonSpecList;
  //
  //   // Get [buttonRadius] within the instance of [AppData]
  //   // registered with [GetIt].
  //   double buttonRadius = GetItService
  //       .instance<AppData>()
  //       .buttonRadius;
  //
  //   // Get [buttonPaddingMainAxisAlt] within the instance of [AppData]
  //   // registered with [GetIt].
  //   double buttonPaddingMainAxisAlt = GetItService
  //       .instance<AppData>()
  //       .buttonPaddingMainAxisAlt;
  //
  //   // A length -- button width plus padding -- for defining [coordinateList].
  //   // Using two parameters allows for the bounding boxes of buttons to overlap.
  //   double dim = 2 * (buttonRadius + buttonPaddingMainAxisAlt);
  //
  //   // Loop over items in [buttonSpecList] and convert each to its
  //   // corresponding position.
  //   List<double> coordinateList = [];
  //   for (int i = 0; i < buttonSpecList.length; i++) {
  //     coordinateList.add(dim * i);
  //   }
  //   return coordinateList;
  // }

  /// Calculates the [Rect] data associated with [buttonArray].
  static Rect get rect => GetItService.instance<AppData>().buttonArrayRect;

  /// Generates a list of buttons.
  List<Widget> buttonArrayGenerator(
      Axis buttonAxis, Alignment buttonAlignment) {
    // Get [buttonSpecList] within the instance of [AppData]
    // registered with [GetIt].
    List<ButtonSpec> buttonSpecList =
        GetItService.instance<AppData>().buttonSpecList;

    // Take a local copy of [buttonCoordinates] for speed.
    List<double> coordinates = buttonCoordinates;

    // Loop over items in [buttonSpecList], convert each to its
    // corresponding [button] and store result in [buttonList].
    List<Widget> buttonList = [];
    for (int i = 0; i < buttonSpecList.length; i++) {
      //  Defines the [button] to be added to [buttonList] in this iteration.
      Button button = Button(
        buttonSpec: buttonSpecList[i],
      );

      // Treat horizontal and vertical axes differently.
      if (buttonAxis == Axis.horizontal) {
        // The top and bottom inputs to [Positioned] must be 0.0 or null,
        // depending on whether the selected alignment is top or bottom.
        //
        // The left and right inputs to [Positioned] must be non-zero
        // coordinates or null, depending on whether the selected alignment
        // is left or right.
        buttonList.add(Positioned(
          top: (buttonAlignment.y < 0) ? 0 : null,
          bottom: (buttonAlignment.y > 0) ? 0 : null,
          left: (buttonAlignment.x < 0) ? coordinates[i] : null,
          right: (buttonAlignment.x > 0) ? coordinates[i] : null,
          child: button,
        ));
      }

      // Treat horizontal and vertical axes differently.
      if (buttonAxis == Axis.vertical) {
        // The left and right inputs to [Positioned] must be 0.0 or null,
        // depending on whether the selected alignment is left or right.
        //
        // The top and bottom inputs to [Positioned] must be non-zero
        // coordinates or null, depending on whether the selected alignment
        // is top or bottom.
        buttonList.add(Positioned(
          top: (buttonAlignment.y < 0) ? coordinates[i] : null,
          bottom: (buttonAlignment.y > 0) ? coordinates[i] : null,
          left: (buttonAlignment.x < 0) ? 0.0 : null,
          right: (buttonAlignment.x > 0) ? 0.0 : null,
          child: button,
        ));
      }
    }
    return buttonList;
  }

  @override
  Widget build(BuildContext context) {
    // Watch for changes to [AppData.buttonAxis] registered with [GetIt].
    Axis buttonAxis = watchOnly((AppData a) => a.buttonAxis);

    // Watch for changes to [AppData.buttonAlignment] registered with [GetIt].
    Alignment buttonAlignment = watchOnly((AppData a) => a.buttonAlignment);

    // Generate the array of buttons.
    List<Widget> buttonArray =
        buttonArrayGenerator(buttonAxis, buttonAlignment);

    // Return an instance of [Stack] with its children defined to be a
    // list of buttons. [buttonArray] is generated by [buttonArrayGenerator]
    // and has length equal to [buttonSpecList].length.
    return Stack(
      children: buttonArray,
    );
  }
}
